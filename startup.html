<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Starting the grasping pipeline &mdash; Grasping Pipeline 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=10e673fd" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=e031e9a9"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=35a8b989"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Adding a new estimator or detector to the grasping pipeline" href="adding_new_estimators.html" />
    <link rel="prev" title="1. Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Grasping Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">1. Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Starting the grasping pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#turning-on-the-robot">2.1. Turning on the robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">2.2. Starting the grasping pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tmux-session-layout">2.2.1. Tmux session layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rviz-visualization">2.2.2. Rviz visualization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="adding_new_estimators.html">3. Adding a new estimator or detector to the grasping pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_new_objects.html">4. Adding new objects to the grasping pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_state_machine.html">5. Overview of the statemachine</a></li>
<li class="toctree-l1"><a class="reference internal" href="details_state_machine.html">6. Detailed Description of the state machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">7. API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Grasping Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Starting the grasping pipeline</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/startup.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="starting-the-grasping-pipeline">
<h1><span class="section-number">2. </span>Starting the grasping pipeline<a class="headerlink" href="#starting-the-grasping-pipeline" title="Permalink to this heading"></a></h1>
<p>This page will tell you how to start the grasping pipeline. It will also explain how to use the tmux session that is created when starting the grasping pipeline. It will also explain how to start the grasping-pipeline rviz visualization and which visualization topics exist.</p>
<section id="turning-on-the-robot">
<h2><span class="section-number">2.1. </span>Turning on the robot<a class="headerlink" href="#turning-on-the-robot" title="Permalink to this heading"></a></h2>
<p>Before starting the grasping pipeline, you should turn on the robot.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you start the grasping pipeline, a window will open displaying the commands listed in this section. You don’t need to run these commands manually beforehand. However, they are explained here because they are necessary if a user wishes to use the HSR without the grasping pipeline. For more details, see <a class="reference external" href="https://github.com/v4r-tuwien/hsr_startup">our repository</a>.</p>
</div>
<p>After the robot is turned on, you have to manually start the startup procedure of the robot which aligns the robot with the pre-recorded map of the environment.
This is necessary so that the waypoints work as expected.</p>
<p>To start the startup procedure, you first have to ssh into the robot. Ask other team members for the password.:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh<span class="w"> </span>v4r@hsrb.local
</pre></div>
</div>
<p>After you are connected to the robot, you can start the startup procedure by running the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">v4r@hsrb $ </span>startup
</pre></div>
</div>
<p>The robot should start to move its head until it detects the marker which is placed on the wall.
After it detects the marker, it should update its pose relative to the map.</p>
<p>Afterwards you can let the robot drive to the table by running the following command (while still being connected to the robot via ssh):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">v4r@hsrb $ </span>table
</pre></div>
</div>
</section>
<section id="id1">
<h2><span class="section-number">2.2. </span>Starting the grasping pipeline<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>If you set up the grasping pipeline according to the installation instructions, you should be able to start the grasping pipeline tmux session by running the following command in the terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gp
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using the Docker container make sure to start the container first:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@host         $ </span>hsr
<span class="gp">root@CONTAINER_ID $ </span>gp
</pre></div>
</div>
</div>
<p>This should open up a tmux session.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The tmux session also runs code on sasha by starting it via ssh. Make sure that sasha is turned on and that the network connection is established.</p>
<p>Additionally, you should setup keys for the ssh connection to sasha (if you haven’t done so yet). This way you don’t have to enter the password every time you connect to sasha (= every time you start the tmux session). You can do this with the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh-keygen
<span class="gp">$ </span>ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/NAME_OF_THE_KEY.pub<span class="w"> </span>v4r@hsrb.local
</pre></div>
</div>
<p>This creates a key pair and copies the public key to sasha. You should now be able to connect to sasha without entering a password.
Both command should be run <strong>inside</strong> the container. After creating the ssh key, <strong>restart</strong> the tmux session.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tmux is a terminal multiplexer, allowing to view different terminals side by side (as explained in the next session). Here are some important shortscuts and commands needed for tmux:
- <cite>CTRL+b</cite> and then <cite>n</cite> switches between different tmux windows (as explained in the next section)
- <cite>CTRL+b</cite> and then <cite>d</cite> detaches you from the session. You combine this with the command <cite>tmux kill-session -t [session name]</cite> to stop the session or <cite>pkill tmux*</cite> to stop all sessions.
- <cite>tmux attach -t [session name]</cite> attaches you to a running session
There are many more shortcuts for e.g. creating, switching, closing or renaming windows. For more information please refer to the <a class="reference external" href="https://wiki.ubuntuusers.de/tmux/">offical documentation</a>.</p>
</div>
<section id="tmux-session-layout">
<h3><span class="section-number">2.2.1. </span>Tmux session layout<a class="headerlink" href="#tmux-session-layout" title="Permalink to this heading"></a></h3>
<p>When starting the grasping pipeline, a tmux session is created. The tmux session is divided into two windows and multiple panes.</p>
<p>The first window is split into five panes:
- <strong>Grasping Pipeline: Statemachine</strong>: The state machine. This is where the current state will be printed and user input must be given.
- <strong>Grasping Pipeline: Locally running nodes</strong>: All nodes which communicate with the grasping pipeline or outside servers (e.g. severs/clients for requesting grasp poses, object detection) are started here.
- <strong>Grasping Pipeline: RViz</strong>: RViz visualization
- <strong>Grasping Pipeline: Parameter launch</strong>: Here a launch file is used to publish all ROS parameters
- <strong>Startup</strong>: This is where the startup script (from the previous section) can be used. This terminal is connected to the HSR, which is why using an SSH key is recommended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Generally, most nodes are running locally because the development computer is much more powerful than sasha.
However, some nodes are running on sasha to reduce the network load because they subscribe to topics that require a high bandwith (e.g. pointclouds or rgb/depth images).</p>
</div>
<a class="reference internal image-reference" href="_images/tmux_panes.svg"><img alt="_images/tmux_panes.svg" class="align-center" src="_images/tmux_panes.svg" width="80%" /></a>
<p>None of the panes are running when the tmux session is started. You can start them by navigating to the corresponding window and pressing enter.</p>
<p>You should start the nodes in the following order:</p>
<ol class="arabic simple">
<li><p>Start the startup script in the bottom right terminal. As explained earlier, this has only to be done <strong>once</strong>, whenever the HSR is restarted.</p></li>
<li><p>Start the pose estimator and wait until it is running (optional). By default the table plane extractor is used to estimate the pose of the object. If this is sufficient for your use case, you don’t have to do anything. However, if you want to use another pose estimator, you should start it before starting the grasping pipeline. Additionally you need to update the <code class="docutils literal notranslate"><span class="pre">config/config.yaml</span></code> file to use the new pose estimator. For a collection of pose estimators (and others) please take a look at <a class="reference external" href="https://github.com/v4r-tuwien/PODGE">PODGE</a>.</p></li>
<li><p>Launch the parameters in the bottom middle terminal to set the ROS parameters. If you modify any parameter in <code class="docutils literal notranslate"><span class="pre">config/config.yaml</span></code> you do <strong>not</strong> need to restart the grasping pipeline or the servers and client. Simply re-launch the parameters using this terminal.</p></li>
<li><p>Start the locally running nodes by navigating to the top middle terminal. You’ll know the servers started correctly if you don’t see any error messages and the <code class="docutils literal notranslate"><span class="pre">execute</span> <span class="pre">grasp</span></code> node started (<cite>Execute grasp: Init</cite>), as this node usually takes the longest to initialize.</p></li>
<li><p>Wait for a couple of seconds and then start the statemachine by navigating to the left pane and pressing enter.</p></li>
<li><p>Open rviz if needed.</p></li>
</ol>
<p>Additionally, there is a second window in the tmux session. This window only has one pane which is used to automatically start MoveIt. MoveIt is running on sasha because of the high bandwith requirements.</p>
<a class="reference internal image-reference" href="_images/tmux_panes2.svg"><img alt="_images/tmux_panes2.svg" class="align-center" src="_images/tmux_panes2.svg" width="80%" /></a>
<p>You can swap between the windows by pressing <cite>Ctrl+b</cite> and then <cite>n</cite>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>MoveIt will only start automatically if an SSH key is saved. Otherwise, you’ll need to start MoveIt <strong>manually</strong> each time.</p>
</div>
<p>The grasping pipeline succesfully started if you see the following output in the tmux session:</p>
<a class="reference internal image-reference" href="_images/tmux_succesful_start.png"><img alt="_images/tmux_succesful_start.png" class="align-center" src="_images/tmux_succesful_start.png" style="width: 80%;" /></a>
<p>The MoveIt window should show the message “You can start planning now!”:</p>
<a class="reference internal image-reference" href="_images/tmux_moveit.png"><img alt="_images/tmux_moveit.png" class="align-center" src="_images/tmux_moveit.png" style="width: 80%;" /></a>
<p>Note that MoveIt prints warnings very often (Thanks Toyota!). This means that you might have to scroll up quite a bit to see the “You can start planning now!” message.</p>
</section>
<section id="rviz-visualization">
<h3><span class="section-number">2.2.2. </span>Rviz visualization<a class="headerlink" href="#rviz-visualization" title="Permalink to this heading"></a></h3>
<p>This section will explain how to start the grasping-pipeline rviz visualization.
All grasping-pipeline related visualization topics will be listed and explained.</p>
<p>Start the grasping-pipeline rviz visualization by running the following command in the terminal:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>rv
</pre></div>
</div>
<p>This should open up the following rviz window that is customized for using the grasping-pipeline, if you used the provided rviz configuration file.</p>
<a class="reference internal image-reference" href="_images/Rviz_startup.png"><img alt="_images/Rviz_startup.png" class="align-center" src="_images/Rviz_startup.png" style="width: 80%;" /></a>
<p>The following visualization topics are turned on by default:</p>
<ul class="simple">
<li><p><strong>Grid</strong>: A grid that helps to estimate the size of objects in the scene.</p></li>
<li><p><strong>Static Map</strong>: The prerecorded map of the environment. All waypoints that the grasping pipeline uses are relative to this map.</p></li>
<li><p><strong>Dynamic Map</strong>: The map that is created by the robot while exploring the environment. It is used to prevent the robot from colliding with obstacles during navigation.</p></li>
<li><p><strong>Robot Model</strong>: The robot model that is used for visualization. By default the collision model is used to visualize the robot.</p></li>
<li><p><strong>MoveIt Trajectory</strong>: The trajectory that MoveIt is planning for the robot. It is only shortly shown when the robot succesfully planned a motion.</p></li>
<li><p><strong>Laser Scanner</strong>: The laser scanner data that is used for obstacle avoidance.</p></li>
<li><p><strong>TF</strong>: Visualize the coordinate frames of the robot and the objects in the scene. The visualization of most frames is turned off by default.</p></li>
<li><p><strong>Placement Debug BB</strong>: The (enlarged) bounding box of the plane that the robot will place the object on.</p></li>
<li><p><strong>Placement Debug Waypoints</strong>: The waypoints that the robot uses to place objects on the table.</p></li>
<li><p><strong>Grasp BB and Grasp Marker</strong>: The bounding box of the object that the robot is trying to grasp and a grasp marker that shows the grasp pose.</p></li>
<li><p><strong>Xtion Point Cloud</strong>: The point cloud of the RGBD-camera that is mounted on the head of the robot.</p></li>
<li><p><strong>Pose Estimation Result image</strong>: 2D image of the pose estimation result. It shows the detected object and the estimated pose of the object (projected onto the image).</p></li>
</ul>
<p>The following topics are turned off by default:</p>
<ul class="simple">
<li><p><strong>MoveIt Motion Planning:</strong> Provides options to change the used planner, change the collision environment, and many more.</p></li>
<li><p><strong>MoveIt Planning Scene:</strong> Visualizes the environment that is used for motion planning. It shows the robot, some manually added collision objects (e.g. the table), and an octomap that is created from the point cloud and laser data.</p></li>
<li><p><strong>Raw Image:</strong> The raw RGB image of the RGBD-camera that is mounted on the head of the robot.</p></li>
</ul>
<p>This is only a short overview of the most commonly used visualization topics. There are more visualization topics available. You can see a list of all available topics by clicking on the “Add” button in the “Displays” panel.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you encounter any timeout errors (e.g. when starting new ros-nodes) make sure to disable the point cloud and the raw camera image visualizations as they use up a lot of bandwidth (~160-250 Mbps each!).
This can be done by unchecking the corresponding checkboxes in the “Displays” panel.
After succesfully starting the new ros-nodes you can enable the point cloud and raw camera image visualizations again.</p>
</div>
<p>Some images of the visualization topics are shown below:</p>
<figure class="align-default" id="id2">
<img alt="_images/laser_and_robot.png" src="_images/laser_and_robot.png" />
<figcaption>
<p><span class="caption-text">This image shows the static map, the dynamic map, the robot model, and the laser scanner data.</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id3">
<img alt="_images/planning_scene.png" src="_images/planning_scene.png" />
<figcaption>
<p><span class="caption-text">This image shows the MoveIt planning scene. The robot, the collision object for the table (green bounding box), and the octomap are visible.</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id4">
<img alt="_images/after_find_grasp.png" src="_images/after_find_grasp.png" />
<figcaption>
<p><span class="caption-text">This image shows the bounding box of the object that the robot is trying to grasp (blue) and the grasp marker (red arrow). Additionally, the pose estimation result image is shown.</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id5">
<img alt="_images/after_placement.png" src="_images/after_placement.png" />
<figcaption>
<p><span class="caption-text">This image shows the bounding box of the table that the robot will place the object on (green) and the waypoints that the robot uses to place the object on the table (white marker).
Additionally, the bounding box of the object is shown (green). The translation of the object is most likely wrong. It should only be used to see the orientation of the object after the placement.</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="1. Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="adding_new_estimators.html" class="btn btn-neutral float-right" title="3. Adding a new estimator or detector to the grasping pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alexander Haberl.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>