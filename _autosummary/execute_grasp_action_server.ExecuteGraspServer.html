<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.3.2. execute_grasp_action_server.ExecuteGraspServer &mdash; Grasping Pipeline 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=10e673fd" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e031e9a9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=35a8b989"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.4. find_table_planes" href="find_table_planes.html" />
    <link rel="prev" title="7.3.1. execute_grasp_action_server.qv_mult" href="execute_grasp_action_server.qv_mult.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Grasping Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../startup.html">2. Starting the grasping pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adding_new_estimators.html">3. Adding a new estimator or detector to the grasping pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adding_new_objects.html">4. Adding new objects to the grasping pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview_state_machine.html">5. Overview of the statemachine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../details_state_machine.html">6. Detailed Description of the state machine</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">7. API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="collision_environment.html">7.1. collision_environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct_grasppose_estimator.html">7.2. direct_grasppose_estimator</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="execute_grasp_action_server.html">7.3. execute_grasp_action_server</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="execute_grasp_action_server.qv_mult.html">7.3.1. execute_grasp_action_server.qv_mult</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">7.3.2. execute_grasp_action_server.ExecuteGraspServer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#execute_grasp_action_server.ExecuteGraspServer"><code class="docutils literal notranslate"><span class="pre">ExecuteGraspServer</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="find_table_planes.html">7.4. find_table_planes</a></li>
<li class="toctree-l2"><a class="reference internal" href="grasp_annotator.html">7.5. grasp_annotator</a></li>
<li class="toctree-l2"><a class="reference internal" href="grasppose_estimator.html">7.6. grasppose_estimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="hsr_wrapper.html">7.7. hsr_wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_fetcher.html">7.8. image_fetcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="moveit_wrapper.html">7.9. moveit_wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="object_detector.html">7.10. object_detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="place.html">7.11. place</a></li>
<li class="toctree-l2"><a class="reference internal" href="pose_estimator.html">7.12. pose_estimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot_control.html">7.13. robot_control</a></li>
<li class="toctree-l2"><a class="reference internal" href="statemachine_components.html">7.14. statemachine_components</a></li>
<li class="toctree-l2"><a class="reference internal" href="statemachine_llm.html">7.15. statemachine_llm</a></li>
<li class="toctree-l2"><a class="reference internal" href="statemachine.html">7.16. statemachine</a></li>
<li class="toctree-l2"><a class="reference internal" href="userinput.html">7.17. userinput</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualizer.html">7.18. visualizer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Grasping Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html"><span class="section-number">7. </span>API</a></li>
          <li class="breadcrumb-item"><a href="execute_grasp_action_server.html"><span class="section-number">7.3. </span>execute_grasp_action_server</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7.3.2. </span>execute_grasp_action_server.ExecuteGraspServer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_autosummary/execute_grasp_action_server.ExecuteGraspServer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="execute-grasp-action-server-executegraspserver">
<h1><span class="section-number">7.3.2. </span>execute_grasp_action_server.ExecuteGraspServer<a class="headerlink" href="#execute-grasp-action-server-executegraspserver" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">execute_grasp_action_server.</span></span><span class="sig-name descname"><span class="pre">ExecuteGraspServer</span></span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The ExecuteGraspServer class is a ROS action server that plans and executes a grasp pose.</p>
<p>It receives a goal with a list of grasp poses and tries to execute them one by one. If a grasp
pose is successfully executed, the object is grasped and the server returns the transform from
the object’s bottom surface to the wrist frame. If no grasp pose is successfully executed, the
server returns terminates with an aborted status.</p>
<p>The grasp poses are sorted by their orientation and distance. Top grasps are executed last.
This means that the closest grasp pose that is not a top grasp is executed first. After
trying all non-top grasps, the top grasps are executed in the same order (closest first).
This is done because placing objects into shelves is easier when the object is grasped from
the side.</p>
<p>The server first moves the robot gripper to a point that is a certain safety distance away from
the object, before moving the gripper to the grasp pose. This is to avoid collisions with the
object. After grasping the object, the server moves the object up by a certain distance to avoid
collisions with the table. Finally, the server retreats in the same direction as the approach to
prevent collisions with other objects on the table.
The server checks if the grasp was successful by checking the distance between the gripper tips.
If the grasp failed the tips are very close to each other and the server aborts the action.</p>
<p>The transformation between the object’s bottom surface and the wrist frame is saved right before
the gripper closes around the object. This transformation is needed for placement because the
only assumption we can make is that the object is placeable on the surface that it was standing
on when it was grasped.</p>
<p>The server uses the MoveitWrapper to plan and execute the robot’s movements inside the collision
environment and the HSR_wrapper to plan and execute the robot’s movements without collision
checking (and because Moveit has no move_end_effector_by_line function which produces a smooth
motion).</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.tf_wrapper">
<span class="sig-name descname"><span class="pre">tf_wrapper</span></span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.tf_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>A wrapper around tf2_ros to transform poses between different frames.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>TF2Wrapper</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.moveit_wrapper">
<span class="sig-name descname"><span class="pre">moveit_wrapper</span></span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.moveit_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>A wrapper around Moveit to plan and execute the robot’s movements.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="moveit_wrapper.MoveitWrapper.html#moveit_wrapper.MoveitWrapper" title="moveit_wrapper.MoveitWrapper">MoveitWrapper</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.hsr_wrapper">
<span class="sig-name descname"><span class="pre">hsr_wrapper</span></span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.hsr_wrapper" title="Permalink to this definition"></a></dt>
<dd><p>A wrapper around the HSR robot to plan and execute the robot’s movements.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="hsr_wrapper.HSR_wrapper.html#hsr_wrapper.HSR_wrapper" title="hsr_wrapper.HSR_wrapper">HSR_wrapper</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.server">
<span class="sig-name descname"><span class="pre">server</span></span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.server" title="Permalink to this definition"></a></dt>
<dd><p>The ROS action server that receives the grasp pose and executes it.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>actionlib.SimpleActionServer</p>
</dd>
</dl>
</dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grasp_poses</strong> (<em>list</em><em> of </em><em>PoseStamped</em>) – The list of grasp poses to execute.</p></li>
<li><p><strong>grasp_object_name_moveit</strong> (<em>string</em><em> (</em><em>optional</em><em>)</em>) – The name of the object to grasp in the Moveit environment. If provided, the object is attached
to the gripper after grasping it. The transformation ‘placement_surface_to_wrist’ is only computed
when this parameter is provided. This transformation is currently only used for placement.</p></li>
<li><p><strong>table_plane_equations</strong> (<em>list</em><em> of </em><em>Plane</em><em> (</em><em>optional</em><em>)</em>) – The plane equations of the table surfaces. The table plane equations are used to compute the
transformation between the object’s bottom surface and the wrist frame ‘placement_surface_to_wrist’.
This transformation is currently only used for placement.</p></li>
<li><p><strong>/safety_distance</strong> (<em>float</em>) – The distance to move the gripper away from the object before grasping it.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The result of the action server containing the transformation from the object’s bottom
surface to the wrist frame (‘placement_surface_to_wrist’) and a boolean indicating if the
grasp was a top grasp (‘top_grasp’). The transformation is only computed and returned if
‘grasp_object_name_moveit’ is provided. It is currently only used/needed for placement.
The server aborts if no grasp pose was successfully executed or if the grasp failed.
If the grasp was successful, the server returns succeeded and the transformation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ExecuteGraspResult</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Initialize and starts the action server.</p>
</dd></dl>

<p class="rubric">Methods</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#execute_grasp_action_server.ExecuteGraspServer.__init__" title="execute_grasp_action_server.ExecuteGraspServer.__init__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__init__</span></code></a>()</p></td>
<td><p>Initialize and starts the action server.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#execute_grasp_action_server.ExecuteGraspServer.execute" title="execute_grasp_action_server.ExecuteGraspServer.execute"><code class="xref py py-obj docutils literal notranslate"><span class="pre">execute</span></code></a>(goal)</p></td>
<td><p>Tries to execute the grasp poses in the goal one by one until a successful grasp is done.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#execute_grasp_action_server.ExecuteGraspServer.get_transform_from_wrist_to_object_bottom_plane" title="execute_grasp_action_server.ExecuteGraspServer.get_transform_from_wrist_to_object_bottom_plane"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_transform_from_wrist_to_object_bottom_plane</span></code></a>(...)</p></td>
<td><p>Compute the transformation from the wrist frame to the object's bottom surface frame.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#execute_grasp_action_server.ExecuteGraspServer.sort_grasps_by_orientation" title="execute_grasp_action_server.ExecuteGraspServer.sort_grasps_by_orientation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sort_grasps_by_orientation</span></code></a>(grasp_poses)</p></td>
<td><p>Sorts grasp poses by their orientation to distinguish between top and not top grasps</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.execute">
<span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">goal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.execute" title="Permalink to this definition"></a></dt>
<dd><p>Tries to execute the grasp poses in the goal one by one until a successful grasp is done.</p>
<p>The grasp poses are sorted by their orientation and distance. Top grasps are executed last.
This means that the closest grasp pose that is not a top grasp is executed first. After
trying all non-top grasps, the top grasps are executed in the same order (closest first).
This is done because placing objects into shelves is easier when the object is grasped from
the side.</p>
<p>For each grasp pose, the server first moves the robot gripper to a point that is a certain
safety distance away from the object, before moving the gripper to the grasp pose. This is to
avoid collisions with the object. After grasping the object, the server moves the object up by
a certain distance to avoid collisions with the table. Finally, the server retreats in the same
direction as the approach to prevent collisions with other objects on the table.
The server checks if the grasp was successful by checking the distance between the gripper tips.
If the grasp failed the tips are very close to each other and the server aborts the action.</p>
<p>The transformation between the object’s bottom surface and the wrist frame is saved right before
the gripper closes around the object. This transformation is needed for placement because the
only assumption we can make is that the object is placeable on the surface that it was standing
on when it was grasped. The information about whether the grasp was a top grasp is also saved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>goal</strong> (<em>ExecuteGraspAction</em>) – The goal containing the grasp poses to execute. Includes the grasp poses, the name of the
object to grasp in the Moveit environment and the plane equations of the table surfaces.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.get_transform_from_wrist_to_object_bottom_plane">
<span class="sig-name descname"><span class="pre">get_transform_from_wrist_to_object_bottom_plane</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grasp_object_name_moveit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_plane_equation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">planning_frame</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.get_transform_from_wrist_to_object_bottom_plane" title="Permalink to this definition"></a></dt>
<dd><p>Compute the transformation from the wrist frame to the object’s bottom surface frame.</p>
<p>The transformation is computed by first transforming the object’s pose to the table frame
and then computing the object’s bottom surface center in the table frame. The object’s bottom
surface center is then aligned with the robot base frame axes. This alignment is done to ensure
that the object’s bottom surface z-axis consistently points in the same direction as the robot
base frame z-axis (etc. for x and y axes). This way we can consistently compute the transformation
between the object’s bottom surface and the wrist frame when doing placement.
The transformation between the object’s bottom surface and the wrist frame is then computed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>goal</strong> (<em>ExecuteGraspAction</em>) – The goal containing the grasp poses to execute. Includes the grasp poses, the name of the
object to grasp in the Moveit environment and the plane equations of the table surfaces.</p></li>
<li><p><strong>planning_frame</strong> (<em>str</em>) – The name of the planning frame in the Moveit environment.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The transformation from the object’s bottom surface to the wrist frame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>geometry_msgs/Transform</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="execute_grasp_action_server.ExecuteGraspServer.sort_grasps_by_orientation">
<span class="sig-name descname"><span class="pre">sort_grasps_by_orientation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grasp_poses</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#execute_grasp_action_server.ExecuteGraspServer.sort_grasps_by_orientation" title="Permalink to this definition"></a></dt>
<dd><p>Sorts grasp poses by their orientation to distinguish between top and not top grasps</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>grasp_poses</strong> (<em>geometry_msgs.PoseStamped</em><em>[</em><em>]</em>) – Array with grasp poses in the head_rgbd_sensor_rgb_frame</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with the sorted grasp poses. The grasp are sorted by their orientation
(not top grasps first, then top grasps) and their distances to the robot (=their original order)
list: List with False for not top grasps and True for top grasps</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>geometry_msgs.PoseStamped[]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="execute_grasp_action_server.qv_mult.html" class="btn btn-neutral float-left" title="7.3.1. execute_grasp_action_server.qv_mult" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="find_table_planes.html" class="btn btn-neutral float-right" title="7.4. find_table_planes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alexander Haberl.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>